<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>VR –ò–≥—Ä–∞: –°–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
    <a-scene physics="gravity: -9.8; debug: false;">
        <!-- –ê—Å—Å–µ—Ç—ã (—Ä–µ—Å—É—Ä—Å—ã) -->
        <a-assets>
            <!-- –ó–≤—É–∫–∏ -->
            <audio id="collect-sound" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>
            <audio id="game-over-sound" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/percussion.ogg"></audio>
            
            <!-- –¢–µ–∫—Å—Ç—É—Ä–∞ —Å–∫–∞–π–±–æ–∫—Å–∞ (–ø—Ä–∏—Ä–æ–¥–Ω–∞—è) -->
            <img id="sky-texture" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg" crossorigin="anonymous">
        </a-assets>
        
        <!-- –°–∫–∞–π–±–æ–∫—Å -->
        <a-sky src="#sky-texture" radius="100"></a-sky>
        
        <!-- –ü–æ–ª —Å —Ñ–∏–∑–∏–∫–æ–π -->
        <a-plane 
            id="ground"
            static-body
            position="0 0 0" 
            rotation="-90 0 0" 
            width="50" 
            height="50" 
            color="#4a752c"
            roughness="0.8"
            src="https://cdn.aframe.io/link-traversal/assets/textures/grid.png"
            repeat="10 10"
        ></a-plane>
        
        <!-- –°—Ç–µ–Ω—ã –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ -->
        <a-box static-body position="0 2.5 -25" width="50" height="5" depth="0.5" color="#8B4513"></a-box>
        <a-box static-body position="0 2.5 25" width="50" height="5" depth="0.5" color="#8B4513"></a-box>
        <a-box static-body position="-25 2.5 0" width="0.5" height="5" depth="50" color="#8B4513"></a-box>
        <a-box static-body position="25 2.5 0" width="0.5" height="5" depth="50" color="#8B4513"></a-box>
        
        <!-- –ò–≥—Ä–æ–∫ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ö–∏—Ç–±–æ–∫—Å–æ–º -->
        <a-entity id="player" 
                  position="0 3 5"
                  kinematic-body="radius: 0.8; height: 3">
            <a-entity camera
                position="0 1.6 0"
                look-controls="pointerLockEnabled: true"
                wasd-controls="acceleration: 100; fly: false; easing: 20"
                cursor="rayOrigin: mouse">
                <a-cursor 
                    id="cursor"
                    color="#FF0000"
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                ></a-cursor>
            </a-entity>
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ö–∏—Ç–±–æ–∫—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å) -->
            <a-cylinder 
                id="player-hitbox"
                position="0 -1 0"
                radius="0.8"
                height="3"
                material="color: #FF0000; opacity: 0.3; transparent: true; visible: false"
                static-body="shape: cylinder; mass: 0"
            ></a-cylinder>
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (–Ω–æ–≥–∏) -->
            <a-box position="-0.2 -1.5 0" width="0.3" height="0.3" depth="0.3" color="#333333"></a-box>
            <a-box position="0.2 -1.5 0" width="0.3" height="0.3" depth="0.3" color="#333333"></a-box>
        </a-entity>
        
        <!-- UI: –°—á–µ—Ç -->
        <a-entity position="0 2.5 -1.5">
            <a-text 
                id="score-text" 
                value="–°—á–µ—Ç: 0" 
                position="0 0 0" 
                color="#FFFFFF" 
                align="center"
                scale="2 2 2"
                font="mozillavr"
            ></a-text>
        </a-entity>
        
        <!-- UI: –¢–∞–π–º–µ—Ä -->
        <a-entity position="0 2 -1.5">
            <a-text 
                id="timer-text" 
                value="–í—Ä–µ–º—è: 60" 
                position="0 0 0" 
                color="#FFFFFF" 
                align="center"
                scale="1.5 1.5 1.5"
                font="mozillavr"
            ></a-text>
        </a-entity>
        
        <!-- UI: –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <a-entity position="0 1.5 -1.5">
            <a-text 
                id="progress-text" 
                value="–û–±—ä–µ–∫—Ç—ã: 0/25" 
                position="0 0 0" 
                color="#FFFFFF" 
                align="center"
                scale="1.5 1.5 1.5"
                font="mozillavr"
            ></a-text>
        </a-entity>
        
        <!-- UI: –û—Ç–ª–∞–¥–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π -->
        <a-entity position="2 2 -1.5">
            <a-text 
                id="debug-text" 
                value="–°—Ç–æ–ª–∫–Ω.: 0" 
                position="0 0 0" 
                color="#00FF00" 
                align="left"
                scale="1 1 1"
                font="mozillavr"
            ></a-text>
        </a-entity>
        
        <!-- UI: –°–æ–æ–±—â–µ–Ω–∏—è -->
        <a-entity id="game-messages" position="0 0 -1.5"></a-entity>
        
        <!-- –û—Å–≤–µ—â–µ–Ω–∏–µ -->
        <a-light type="ambient" color="#FFFFFF" intensity="0.7"></a-light>
        <a-light type="directional" color="#FFFFFF" intensity="0.9" position="-1 3 1" cast-shadow></a-light>
        <a-light type="point" color="#FFD700" intensity="0.5" distance="20" position="0 10 0"></a-light>
    </a-scene>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        let score = 0;
        let timeLeft = 60;
        let gameActive = true;
        let timerInterval;
        let collectedObjects = 0;
        const totalObjects = 25;
        let objects = [];
        let collisionCount = 0;

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ —Ö–∏—Ç–±–æ–∫—Å–∞ –∏–≥—Ä–æ–∫–∞
        AFRAME.registerComponent('player-collider', {
            init: function() {
                this.collisions = [];
                this.lastCollisionCheck = 0;
                
                // –ü–æ–ª—É—á–∞–µ–º —Ö–∏—Ç–±–æ–∫—Å –∏–≥—Ä–æ–∫–∞
                this.hitbox = document.getElementById('player-hitbox');
                
                // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–∑–∏–∫–∏
                setTimeout(() => {
                    if (this.hitbox && this.hitbox.body) {
                        console.log('–•–∏—Ç–±–æ–∫—Å –∏–≥—Ä–æ–∫–∞ –≥–æ—Ç–æ–≤!');
                        
                        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
                        this.hitbox.addEventListener('collide', (e) => {
                            if (!gameActive) return;
                            
                            const other = e.detail.body.el;
                            
                            if (other.classList.contains('collectible')) {
                                collisionCount++;
                                document.getElementById('debug-text').setAttribute('value', `–°—Ç–æ–ª–∫–Ω.: ${collisionCount}`);
                                
                                // –°–æ–±–∏—Ä–∞–µ–º –æ–±—ä–µ–∫—Ç –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏
                                this.collectObject(other);
                            }
                        });
                    }
                }, 2000);
            },
            
            collectObject: function(object) {
                if (!object.hasAttribute('data-collected')) {
                    console.log('–û–±—ä–µ–∫—Ç —Å–æ–±—Ä–∞–Ω!', object.id);
                    
                    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã–π
                    object.setAttribute('data-collected', 'true');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                    const value = parseInt(object.getAttribute('data-value') || 1);
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç
                    score += value;
                    collectedObjects++;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    updateScore();
                    updateProgress();
                    
                    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫
                    const sound = document.getElementById('collect-sound');
                    if (sound) {
                        sound.components.sound.playSound();
                    }
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞ (—É–º–µ–Ω—å—à–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ)
                    object.setAttribute('animation', {
                        property: 'scale',
                        from: '1 1 1',
                        to: '0 0 0',
                        dur: 300,
                        easing: 'easeOutCubic'
                    });
                    
                    // –£–¥–∞–ª—è–µ–º –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ 300–º—Å
                    setTimeout(() => {
                        if (object.parentNode) {
                            object.parentNode.removeChild(object);
                            
                            // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                            const index = objects.indexOf(object);
                            if (index > -1) {
                                objects.splice(index, 1);
                            }
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                            if (collectedObjects >= totalObjects) {
                                endGame(true);
                            }
                        }
                    }, 300);
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        function createCollectibles(count) {
            const scene = document.querySelector('a-scene');
            
            const colors = [
                {color: '#FFD700', value: 10, name: '–∑–æ–ª–æ—Ç–æ'},
                {color: '#C0C0C0', value: 5, name: '—Å–µ—Ä–µ–±—Ä–æ'},
                {color: '#CD7F32', value: 3, name: '–±—Ä–æ–Ω–∑–∞'},
                {color: '#FF6B6B', value: 7, name: '—Ä—É–±–∏–Ω'},
                {color: '#4ECDC4', value: 8, name: '–±–∏—Ä—é–∑–∞'},
                {color: '#45B7D1', value: 6, name: '—Å–∞–ø—Ñ–∏—Ä'},
                {color: '#96CEB4', value: 4, name: '–∏–∑—É–º—Ä—É–¥'},
                {color: '#DDA0DD', value: 9, name: '–∞–º–µ—Ç–∏—Å—Ç'}
            ];
            
            const shapes = [
                {type: 'sphere', radius: 0.5},
                {type: 'box', width: 0.8, height: 0.8, depth: 0.8},
                {type: 'cylinder', radius: 0.4, height: 1},
                {type: 'cone', radius: 0.5, height: 1.2},
                {type: 'octahedron', radius: 0.6},
                {type: 'tetrahedron', radius: 0.7},
                {type: 'dodecahedron', radius: 0.5},
                {type: 'icosahedron', radius: 0.5}
            ];
            
            for (let i = 0; i < count; i++) {
                // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–Ω–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ —Ü–µ–Ω—Ç—Ä—É)
                let x, z;
                let attempts = 0;
                
                do {
                    x = Math.random() * 40 - 20;
                    z = Math.random() * 40 - 20;
                    attempts++;
                } while (Math.abs(x) < 3 && Math.abs(z) < 3 && attempts < 100);
                
                const y = 0.5;
                
                // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –∏ –∑–Ω–∞—á–µ–Ω–∏–µ
                const colorData = colors[Math.floor(Math.random() * colors.length)];
                
                // –°–ª—É—á–∞–π–Ω–∞—è —Ñ–æ—Ä–º–∞
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                const element = document.createElement('a-entity');
                element.setAttribute('class', 'collectible');
                element.setAttribute('id', `obj-${i}`);
                element.setAttribute('position', `${x} ${y} ${z}`);
                element.setAttribute('data-value', colorData.value);
                element.setAttribute('static-body', 'shape: box; mass: 0');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é
                const geometry = document.createElement(`a-${shape.type}`);
                for (const [key, value] of Object.entries(shape)) {
                    if (key !== 'type') {
                        geometry.setAttribute(key, value);
                    }
                }
                geometry.setAttribute('color', colorData.color);
                geometry.setAttribute('metalness', '0.8');
                geometry.setAttribute('roughness', '0.2');
                geometry.setAttribute('shadow', 'cast: true; receive: false');
                
                element.appendChild(geometry);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
                element.setAttribute('animation', {
                    property: 'rotation',
                    to: `0 ${360 + Math.random() * 360} 0`,
                    dur: 4000 + Math.random() * 6000,
                    loop: true,
                    easing: 'linear'
                });
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞—Ä–µ–Ω–∏—è
                element.setAttribute('animation__float', {
                    property: 'position',
                    from: `${x} ${y} ${z}`,
                    to: `${x} ${y + 0.8} ${z}`,
                    dir: 'alternate',
                    dur: 2000 + Math.random() * 2000,
                    loop: true,
                    easing: 'easeInOutSine'
                });
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                element.setAttribute('light', {
                    type: 'point',
                    color: colorData.color,
                    intensity: 0.3,
                    distance: 3
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
                scene.appendChild(element);
                objects.push(element);
                
                console.log(`–°–æ–∑–¥–∞–Ω –æ–±—ä–µ–∫—Ç ${i}: ${shape.type} (${colorData.name}) –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${x}, ${z}`);
            }
            
            console.log(`–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ ${objects.length} –æ–±—ä–µ–∫—Ç–æ–≤`);
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        function initCollisionDetection() {
            const player = document.getElementById('player');
            const hitbox = document.getElementById('player-hitbox');
            
            setInterval(() => {
                if (!gameActive) return;
                
                const playerPos = player.getAttribute('position');
                
                objects.forEach((obj, index) => {
                    if (!obj.parentNode) {
                        objects.splice(index, 1);
                        return;
                    }
                    
                    const objPos = obj.getAttribute('position');
                    const distance = Math.sqrt(
                        Math.pow(playerPos.x - objPos.x, 2) +
                        Math.pow(playerPos.z - objPos.z, 2)
                    );
                    
                    // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±–ª–∏–∑–∫–æ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—å—à–µ 1.2) –∏ –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ —Ç–æ–π –∂–µ –≤—ã—Å–æ—Ç–µ
                    if (distance < 1.2 && !obj.hasAttribute('data-collected')) {
                        collisionCount++;
                        document.getElementById('debug-text').setAttribute('value', `–°—Ç–æ–ª–∫–Ω.: ${collisionCount}`);
                        
                        // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã–π
                        obj.setAttribute('data-collected', 'true');
                        
                        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                        const value = parseInt(obj.getAttribute('data-value') || 1);
                        
                        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç
                        score += value;
                        collectedObjects++;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º UI
                        updateScore();
                        updateProgress();
                        
                        // –ó–≤—É–∫
                        const sound = document.getElementById('collect-sound');
                        if (sound) {
                            sound.components.sound.playSound();
                        }
                        
                        // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
                        obj.setAttribute('animation__collect', {
                            property: 'scale',
                            from: '1 1 1',
                            to: '0 0 0',
                            dur: 300,
                            easing: 'easeOutCubic'
                        });
                        
                        // –£–¥–∞–ª—è–µ–º —Å–≤–µ—Ç
                        obj.removeAttribute('light');
                        
                        // –£–¥–∞–ª—è–µ–º –æ–±—ä–µ–∫—Ç
                        setTimeout(() => {
                            if (obj.parentNode) {
                                obj.parentNode.removeChild(obj);
                                objects.splice(index, 1);
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                                if (collectedObjects >= totalObjects) {
                                    endGame(true);
                                }
                            }
                        }, 300);
                    }
                });
            }, 100);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞
        function updateScore() {
            const scoreText = document.getElementById('score-text');
            scoreText.setAttribute('value', `–°—á–µ—Ç: ${score}`);
            
            scoreText.setAttribute('animation__pulse', {
                property: 'scale',
                from: '2 2 2',
                to: '2.3 2.3 2.3',
                dur: 200,
                easing: 'easeOutQuad',
                direction: 'alternate'
            });
            
            setTimeout(() => {
                scoreText.removeAttribute('animation__pulse');
            }, 200);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress() {
            const progressText = document.getElementById('progress-text');
            progressText.setAttribute('value', `–û–±—ä–µ–∫—Ç—ã: ${collectedObjects}/${totalObjects}`);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        function updateTimer() {
            const timerText = document.getElementById('timer-text');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            timerText.setAttribute('value', `–í—Ä–µ–º—è: ${timeString}`);
            
            if (timeLeft <= 10) {
                timerText.setAttribute('color', '#FF4444');
                
                if (timeLeft <= 5) {
                    timerText.setAttribute('animation__blink', {
                        property: 'opacity',
                        from: '1',
                        to: '0.3',
                        dur: 300,
                        loop: true,
                        direction: 'alternate'
                    });
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        function endGame(isWin) {
            if (!gameActive) return;
            
            gameActive = false;
            clearInterval(timerInterval);
            
            // –£–±–∏—Ä–∞–µ–º –∫—É—Ä—Å–æ—Ä
            const cursor = document.getElementById('cursor');
            if (cursor) {
                cursor.setAttribute('visible', 'false');
            }
            
            // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
            const message = isWin 
                ? "–ü–û–ë–ï–î–ê! üéâ" 
                : "–í–†–ï–ú–Ø –í–´–®–õ–û! ‚è∞";
            
            const finalScore = `\n–°—á–µ—Ç: ${score}\n–û–±—ä–µ–∫—Ç—ã: ${collectedObjects}/${totalObjects}\n–í—Ä–µ–º—è: ${60 - timeLeft} —Å–µ–∫`;
            
            const gameOverText = document.createElement('a-text');
            gameOverText.setAttribute('value', message + finalScore);
            gameOverText.setAttribute('position', '0 1 -2');
            gameOverText.setAttribute('align', 'center');
            gameOverText.setAttribute('color', isWin ? '#FFD700' : '#FF4444');
            gameOverText.setAttribute('scale', '2.5 2.5 2.5');
            gameOverText.setAttribute('font', 'mozillavr');
            
            const restartButton = document.createElement('a-text');
            restartButton.setAttribute('value', '[ –ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û ]');
            restartButton.setAttribute('position', '0 -0.8 -2');
            restartButton.setAttribute('align', 'center');
            restartButton.setAttribute('color', '#00FF00');
            restartButton.setAttribute('scale', '1.8 1.8 1.8');
            restartButton.setAttribute('class', 'clickable');
            restartButton.setAttribute('font', 'mozillavr');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            restartButton.addEventListener('click', function() {
                location.reload();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è
            restartButton.addEventListener('mouseenter', function() {
                this.setAttribute('color', '#00FFFF');
                this.setAttribute('scale', '2 2 2');
            });
            
            restartButton.addEventListener('mouseleave', function() {
                this.setAttribute('color', '#00FF00');
                this.setAttribute('scale', '1.8 1.8 1.8');
            });
            
            const messagesContainer = document.getElementById('game-messages');
            messagesContainer.innerHTML = '';
            messagesContainer.appendChild(gameOverText);
            messagesContainer.appendChild(restartButton);
            
            // –ó–≤—É–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            const sound = document.getElementById('game-over-sound');
            if (sound) {
                sound.components.sound.playSound();
            }
            
            console.log(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! ${isWin ? '–ü–æ–±–µ–¥–∞!' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!'} –°—á–µ—Ç: ${score}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–ª–ª–∏–∑–∏–π –∏–≥—Ä–æ–∫—É
            const player = document.getElementById('player');
            player.setAttribute('player-collider', '');
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã
            createCollectibles(totalObjects);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
            setTimeout(initCollisionDetection, 2000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateScore();
            updateTimer();
            updateProgress();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            timerInterval = setInterval(() => {
                if (!gameActive) return;
                
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
            
            // –í–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ö–∏—Ç–±–æ–∫—Å–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ H (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'h' || e.key === 'H') {
                    const hitbox = document.getElementById('player-hitbox');
                    const isVisible = hitbox.getAttribute('material').visible;
                    hitbox.setAttribute('material', 'visible', !isVisible);
                    console.log(`–•–∏—Ç–±–æ–∫—Å ${!isVisible ? '–≤–∏–¥–∏–º' : '—Å–∫—Ä—ã—Ç'}`);
                }
                if (e.key === 'r' || e.key === 'R') {
                    location.reload();
                }
            });
            
            console.log('–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞! –î–≤–∏–≥–∞–π—Ç–µ—Å—å –∫ –æ–±—ä–µ–∫—Ç–∞–º —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –∏—Ö.');
            console.log('–ù–∞–∂–º–∏—Ç–µ H –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è —Ö–∏—Ç–±–æ–∫—Å–∞ –∏–≥—Ä–æ–∫–∞');
        });
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
            width: 100vw;
            height: 100vh;
        }
        
        a-scene {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .clickable {
            cursor: pointer;
        }
        
        #instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            border-radius: 15px;
            font-size: 14px;
            z-index: 1000;
            text-align: center;
            border: 2px solid #FFD700;
            max-width: 450px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
        }
        
        #instructions h3 {
            margin-top: 0;
            color: #FFD700;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 3px solid #FFD700;
        }
        
        .key {
            background: #222;
            color: #FFD700;
            padding: 4px 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
        
        .tip {
            color: #4ECDC4;
            font-size: 13px;
            margin-top: 10px;
            padding: 8px;
            background: rgba(78, 205, 196, 0.1);
            border-radius: 6px;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFD700;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px 50px;
            border-radius: 15px;
            border: 2px solid #FFD700;
        }
        
        .loading-spinner {
            border: 4px solid #333;
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <div id="instructions">
        <h3>üèÜ –°–ë–û–† –û–ë–™–ï–ö–¢–û–í - –ò–ù–°–¢–†–£–ö–¶–ò–Ø üèÜ</h3>
        <div class="controls-grid">
            <div class="control-item">
                <span>–î–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥:</span>
                <span class="key">W</span>
            </div>
            <div class="control-item">
                <span>–î–≤–∏–∂–µ–Ω–∏–µ –Ω–∞–∑–∞–¥:</span>
                <span class="key">S</span>
            </div>
            <div class="control-item">
                <span>–í–ª–µ–≤–æ:</span>
                <span class="key">A</span>
            </div>
            <div class="control-item">
                <span>–í–ø—Ä–∞–≤–æ:</span>
                <span class="key">D</span>
            </div>
            <div class="control-item">
                <span>–û–±–∑–æ—Ä:</span>
                <span class="key">–ú–´–®–¨</span>
            </div>
            <div class="control-item">
                <span>–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:</span>
                <span class="key">R</span>
            </div>
            <div class="control-item">
                <span>–•–∏—Ç–±–æ–∫—Å:</span>
                <span class="key">H</span>
            </div>
        </div>
        <p class="tip">
            <strong>üéØ –¶–ï–õ–¨:</strong> –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ 25 –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ 60 —Å–µ–∫—É–Ω–¥!<br>
            –ü—Ä–æ—Å—Ç–æ –Ω–∞—Å—Ç—É–ø–∞–π—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã - –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä—É—Ç—Å—è.
        </p>
        <p style="font-size: 12px; opacity: 0.7; margin-top: 15px;">
            –¶–≤–µ—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤: –∑–æ–ª–æ—Ç–æ (10 –æ—á–∫–æ–≤), —Å–µ—Ä–µ–±—Ä–æ (5), –±—Ä–æ–Ω–∑–∞ (3)<br>
            –ù–∞–∂–º–∏—Ç–µ H —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–æ–Ω—É —Å–±–æ—Ä–∞ –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞
        </p>
    </div>
    
    <div id="loading">
        <div class="loading-spinner"></div>
        –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...
    </div>
    
    <script>
        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        window.addEventListener('load', function() {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                const instructions = document.getElementById('instructions');
                
                loading.style.display = 'none';
                instructions.style.display = 'block';
                
                // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
                setTimeout(() => {
                    instructions.style.opacity = '0.9';
                    instructions.style.transition = 'opacity 2s';
                }, 8000);
                
                setTimeout(() => {
                    instructions.style.display = 'none';
                }, 12000);
                
                // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–ª–∏–∫—É
                instructions.addEventListener('click', function() {
                    this.style.display = 'none';
                });
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞–∂–∞—Ç–∏—é I
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'i' || e.key === 'I') {
                        const instr = document.getElementById('instructions');
                        instr.style.display = instr.style.display === 'none' ? 'block' : 'none';
                        instr.style.opacity = '1';
                    }
                });
                
            }, 2000);
        });
    </script>
</body>
</html>
